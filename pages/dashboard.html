<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Remblyx Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tab icon -->
  <link rel="icon" type="image/png" sizes="32x32" href="../images/medisignal.png">
  <link rel="icon" type="image/png" sizes="192x192" href="../images/medisignal.png">
  <link rel="apple-touch-icon" href="../images/medisignal.png">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Arial', sans-serif;
    }

    body {
      background: #f5f5f5;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow-x: hidden;
      padding: 16px;
      color: #222;
    }

    /* Blurred background */
    .overlay {
      position: fixed;
      inset: 0;
      z-index: -1;
    }

    .bg-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: blur(4px);
      opacity: 0.8;
    }

    /* Logo top-left */
    .header-row {
      position: fixed;
      top: -27px;
      left: 8px;
      z-index: 20;
    }

    .logo {
      height: 200px;
      cursor: pointer;
      transition: 0.3s ease;
    }

    .logo:hover {
      filter: brightness(1.1);
      transform: scale(1.03);
    }

    /* Main wrapper */
    .dashboard-wrapper {
      width: 100%;
      max-width: 1100px;
      margin-top: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
    }

    .dashboard-title {
      font-size: 26px;
      font-weight: 600;
      color: #222;
      text-shadow: 0 1px 2px rgba(0,0,0,0.12);
      text-align: center;
    }

    .dashboard-subtitle {
      font-size: 14px;
      color: #444;
      text-align: center;
      max-width: 620px;
      margin-bottom: 4px;
    }

    /* Plans row */
    .plans-row {
      display: flex;
      gap: 16px;
      justify-content: center;
      align-items: stretch;
      width: 100%;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .plan-card {
      flex: 1 1 260px;
      max-width: 320px;
      background: rgba(255,255,255,0.97);
      border-radius: 16px;
      padding: 18px 16px 16px;
      box-shadow: 0 8px 22px rgba(0,0,0,0.18);
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      border: 1px solid rgba(255,255,255,0.7);
      backdrop-filter: blur(2px);
      cursor: pointer;
      transition: 0.25s;
    }

    .plan-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 26px rgba(0,0,0,0.22);
    }

    .plan-card.active {
      border: 2px solid #667eea;
      box-shadow: 0 12px 30px rgba(102,126,234,0.35);
    }

    .plan-label {
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #888;
      margin-bottom: 4px;
    }

    .plan-name {
      font-size: 20px;
      font-weight: 600;
      color: #222;
      margin-bottom: 4px;
    }

    .plan-tagline {
      font-size: 12px;
      color: #666;
      margin-bottom: 10px;
    }

    .plan-features {
      list-style: none;
      font-size: 12px;
      color: #444;
      margin-bottom: 12px;
      padding-left: 0;
    }

    .plan-features li {
      margin-bottom: 4px;
    }

    .plan-btn {
      margin-top: auto;
      align-self: stretch;
      padding: 9px 10px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #fff;
      background: linear-gradient(135deg, #667eea, #764ba2);
      transition: 0.25s;
      text-align: center;
    }

    .plan-btn:hover {
      opacity: 0.96;
      transform: translateY(-1px);
    }

    /* Dashboard content based on plan */
    .active-plan-label {
      margin-top: 4px;
      font-size: 14px;
      color: #555;
      text-align: center;
    }

    .plan-highlight {
      font-weight: 600;
      color: #667eea;
    }

    .dashboard-content {
      width: 100%;
      max-width: 900px;
      background: rgba(255,255,255,0.97);
      border-radius: 16px;
      padding: 16px 16px 14px;
      box-shadow: 0 8px 22px rgba(0,0,0,0.18);
      font-size: 13px;
      color: #333;
    }

    .dashboard-section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .dashboard-list {
      margin-left: 16px;
      margin-top: 4px;
    }

    .logout-link {
      margin-top: 8px;
      font-size: 12px;
      color: #888;
      text-align: right;
      cursor: pointer;
      text-decoration: underline;
    }

    /* Mobile */
    @media (max-width: 768px) {
      body { padding: 10px; }

      .logo {
        height: 115px;
      }

      .header-row {
        top: -10px;
      }

      .dashboard-title {
        font-size: 22px;
      }

      .dashboard-subtitle {
        font-size: 13px;
      }

      .plans-row {
        gap: 12px;
      }

      .plan-card {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>

  <!-- Background -->
  <div class="overlay">
    <img src="../images/background.png" alt="Background" class="bg-image">
  </div>

  <!-- Logo -->
  <div class="header-row">
    <img src="../images/remblyxlogo.png"
         alt="Remblyx"
         class="logo"
         onclick="window.location.href='../index.html'">
  </div>

  <!-- Dashboard -->
  <div class="dashboard-wrapper">
    <div>
      <div class="dashboard-title">Welcome to Remblyx</div>
      <div class="dashboard-subtitle">
        Choose a plan to unlock features. Your choice is tied to your account and remembered on every login.
      </div>
      <div id="active-plan-label" class="active-plan-label">
        No plan selected yet. Pick one below.
      </div>
    </div>

    <!-- Plans -->
    <div class="plans-row">
      <!-- Basic -->
      <div class="plan-card" data-plan="Basic">
        <div class="plan-label">Plan</div>
        <div class="plan-name">Basic</div>
        <div class="plan-tagline">For quick testing and personal use.</div>
        <ul class="plan-features">
          <li>✔ Core monitoring</li>
          <li>✔ Limited alerts</li>
          <li>✔ Single user</li>
        </ul>
        <button class="plan-btn">Choose Basic</button>
      </div>

      <!-- Premium -->
      <div class="plan-card" data-plan="Premium">
        <div class="plan-label">Recommended</div>
        <div class="plan-name">Premium</div>
        <div class="plan-tagline">For teams that need more control.</div>
        <ul class="plan-features">
          <li>✔ Everything in Basic</li>
          <li>✔ Priority alerts</li>
          <li>✔ Team collaboration</li>
          <li>✔ Higher limits</li>
        </ul>
        <button class="plan-btn">Choose Premium</button>
      </div>

      <!-- Enterprise (was Dev) -->
      <div class="plan-card" data-plan="Enterprise">
        <div class="plan-label">Advanced</div>
        <div class="plan-name">Enterprise</div>
        <div class="plan-tagline">For integrations & full-scale deployments.</div>
        <ul class="plan-features">
          <li>✔ All Premium features</li>
          <li>✔ API & webhooks</li>
          <li>✔ Audit logs</li>
          <li>✔ Priority support</li>
        </ul>
        <button class="plan-btn">Choose Enterprise</button>
      </div>
    </div>

    <!-- Dynamic dashboard content -->
    <div id="dashboard-content" class="dashboard-content">
      <div class="dashboard-section-title">Get started</div>
      <p>Select a plan above to see features tailored to your account.</p>
    </div>

    <div id="logout" class="logout-link">Log out</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // Same config as your login/signup
    const firebaseConfig = {
      apiKey: "AIzaSyAEosHpiAT72yIIvaT1a8-lAXwsw-mR3i8",
      authDomain: "remblyx-medisignal.firebaseapp.com",
      projectId: "remblyx-medisignal",
      storageBucket: "remblyx-medisignal.appspot.com",
      messagingSenderId: "50711670199",
      appId: "1:50711670199:web:0c9c2ff72cd77234ce0c32",
      measurementId: "G-JQ3843RM4V"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const planCards = document.querySelectorAll(".plan-card");
    const activePlanLabel = document.getElementById("active-plan-label");
    const dashboardContent = document.getElementById("dashboard-content");
    const logoutLink = document.getElementById("logout");

    let currentUser = null;

    // Redirect helper
    const goToLogin = () => {
      window.location.href = "./login.html";
    };

    // Update UI highlight + text
    function setActivePlanUI(plan) {
      planCards.forEach(card => {
        const p = card.getAttribute("data-plan");
        card.classList.toggle("active", p === plan);
      });

      if (!plan) {
        activePlanLabel.innerHTML = "No plan selected yet. Pick one above.";
        dashboardContent.innerHTML = `
          <div class="dashboard-section-title">Get started</div>
          <p>Select a plan above to see features tailored to your account.</p>
        `;
        return;
      }

      activePlanLabel.innerHTML = `
        Current plan: <span class="plan-highlight">${plan}</span>
      `;

      if (plan === "Basic") {
        dashboardContent.innerHTML = `
          <div class="dashboard-section-title">Basic Dashboard</div>
          <p>Welcome to the Basic plan. Perfect for light personal usage.</p>
          <ul class="dashboard-list">
            <li>View limited monitoring stats.</li>
            <li>Configure basic alerts.</li>
            <li>Upgrade anytime by selecting Premium or Enterprise.</li>
          </ul>
        `;
      } else if (plan === "Premium") {
        dashboardContent.innerHTML = `
          <div class="dashboard-section-title">Premium Dashboard</div>
          <p>You’re on the Premium plan. Great for teams.</p>
          <ul class="dashboard-list">
            <li>Team-level monitoring & alerts.</li>
            <li>Priority notifications & extended limits.</li>
            <li>Manage users and shared settings.</li>
          </ul>
        `;
      } else if (plan === "Enterprise") {
        dashboardContent.innerHTML = `
          <div class="dashboard-section-title">Enterprise Dashboard</div>
          <p>Enterprise access unlocked. Designed for full-scale deployments.</p>
          <ul class="dashboard-list">
            <li>Full API & webhook access.</li>
            <li>Advanced logs & analytics.</li>
            <li>Custom integrations & priority support.</li>
          </ul>
        `;
      }
    }

    // Load plan from Firestore for this user
    async function loadUserPlan(user) {
      try {
        const userRef = doc(db, "users", user.uid);
        const snap = await getDoc(userRef);
        if (snap.exists() && snap.data().plan) {
          setActivePlanUI(snap.data().plan);
        } else {
          setActivePlanUI(null);
        }
      } catch (err) {
        console.error("Error loading user plan:", err);
        setActivePlanUI(null);
      }
    }

    // Save selected plan to Firestore
    async function saveUserPlan(plan) {
      if (!currentUser) return;
      try {
        const userRef = doc(db, "users", currentUser.uid);
        await setDoc(
          userRef,
          {
            email: currentUser.email || null,
            plan: plan
          },
          { merge: true }
        );
        setActivePlanUI(plan);
      } catch (err) {
        console.error("Error saving plan:", err);
        alert("Could not save plan. Check console / Firestore rules.");
      }
    }

    // Attach click handlers to plan cards & buttons
    planCards.forEach(card => {
      const plan = card.getAttribute("data-plan");
      const btn = card.querySelector(".plan-btn");

      // Click anywhere on card
      card.addEventListener("click", (e) => {
        // Avoid double-trigger if button also clicked (still fine though)
        if (!currentUser) {
          alert("Please log in again.");
          goToLogin();
          return;
        }
        saveUserPlan(plan);
      });

      // Explicit button click (same behavior)
      if (btn) {
        btn.addEventListener("click", (e) => {
          e.stopPropagation();
          if (!currentUser) {
            alert("Please log in again.");
            goToLogin();
            return;
          }
          saveUserPlan(plan);
        });
      }
    });

    // Logout
    logoutLink.addEventListener("click", async () => {
      await signOut(auth);
      goToLogin();
    });

    // Check auth state on load
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        goToLogin();
        return;
      }
      currentUser = user;
      await loadUserPlan(user);
    });
  </script>
</body>
</html>
