<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Remblyx Advanced Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" sizes="32x32" href="../images/medisignal.png">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif;}
body{background:#f5f5f5;min-height:100vh;color:#222;display:flex;}
#main-dashboard{display:grid;grid-template-columns:220px 1fr;gap:0;height:100vh;width:100vw;overflow:hidden;background:#fff;}
.sidebar{background:#111827;color:#e5e7eb;padding:16px;display:flex;flex-direction:column;gap:12px;}
.sidebar-title{font-size:14px;font-weight:600;color:#9ca3af;text-transform:uppercase;}
.nav-item{display:flex;align-items:center;gap:8px;padding:10px;border-radius:8px;cursor:pointer;color:#d1d5db;transition:.2s;}
.nav-item:hover{background:rgba(249,250,251,.06);}
.nav-item.active{background:#1f2937;color:#fff;border-left:3px solid #667eea;padding-left:7px;}
.icon-dot{width:7px;height:7px;border-radius:999px;background:#4ade80;}
.main-area{padding:16px;display:flex;flex-direction:column;gap:16px;overflow:auto;}
.section-title{font-weight:600;font-size:16px;color:#111827;margin-bottom:8px;}
.board-wrapper{background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px;padding:16px;max-width:100%;overflow:auto;}
button{padding:8px 12px;border:none;border-radius:6px;background:#4CAF50;color:white;cursor:pointer;}
button:hover{background:#45a049;}
.dependant-info{margin-top:12px;padding:12px;background:#fff;border-left:4px solid #4CAF50;border-radius:6px; display:none;}
.dependant-actions{display:flex;gap:8px;margin-top:10px;}
.error{color:red;font-weight:bold;margin-bottom:8px;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:1000;}
.modal.active{display:flex;}
.modal-content{background:#fff;padding:20px;border-radius:12px;width:90%;max-width:400px;box-shadow:0 8px 24px rgba(0,0,0,0.3);max-height:80vh;overflow-y:auto;}
.modal-content h2{margin-top:0;}
.modal-content label{display:block;margin:8px 0 4px;font-weight:600;}
.modal-content input,.modal-content select{width:100%;padding:6px 8px;margin-bottom:10px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box;}
.modal-content .dosage-row{display:flex;gap:6px;}
.modal-content .dosage-row input{flex:1;}
.modal-content .dosage-row select{flex:1;}
.time-picker-container{margin-top:10px;}
.dosage-note{font-size:12px;color:red;margin-top:2px;display:none;}
.phone-note{font-size:12px;color:red;margin-top:2px;display:none;}
.duplicate-note{font-size:12px;color:red;margin-top:2px;display:none;}
.delete-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border-radius:12px;padding:24px;box-shadow:0 8px 24px rgba(0,0,0,0.3);display:none;z-index:2000;max-width:400px;text-align:center;}
.delete-popup p{margin-bottom:20px;font-weight:600;}
.delete-popup button{margin:0 8px;padding:8px 14px;border:none;border-radius:6px;cursor:pointer;}
.btn-confirm{background:#f87171;color:white;}
.btn-cancel{background:#9ca3af;color:white;}
input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: auto; margin: 0; }
.reminder-item{padding:6px;margin:4px 0;background:#fff;border-radius:6px;box-shadow:0 1px 2px rgba(0,0,0,.06);cursor:pointer;}
.reminder-item:hover{background:#eef2ff;}
</style>
</head>
<body>

<div id="main-dashboard">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-title">Dashboard</div>
    <div class="nav-item active" data-nav="dependants"><span class="icon-dot"></span>Dependants</div>
    <div class="nav-item" data-nav="reminders"><span class="icon-dot"></span>Upcoming Reminders</div>
  </aside>

  <!-- Main Area -->
  <div class="main-area">
    <!-- Dependants Section -->
    <div id="dependants" class="dashboard-section">
      <div class="section-title">Your Dependants</div>
      <div class="board-wrapper">
        <div id="mainError" class="error"></div>
        <button id="addDependantBtn">Add Dependant</button>
        <div id="dependantInfo" class="dependant-info">
          <h3>Dependant Profile</h3>
          <p><strong>Name:</strong> <span id="dispName"></span></p>
          <p><strong>Phone Number:</strong> <span id="dispPhone"></span></p>
          <p><strong>Medicine Type:</strong> <span id="dispMedicine"></span></p>
          <p><strong>Dosage:</strong> <span id="dispDosage"></span></p>
          <p><strong>Times to Take Medicine:</strong> <span id="dispTimes"></span></p>
          <p><strong>Additional Notes:</strong> <span id="dispNotes"></span></p>
          <div class="dependant-actions">
            <button id="editDependantBtn" style="background:#3b82f6;">Edit</button>
            <button id="removeDependantBtn" style="background:#f87171;">Remove</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Upcoming Reminders Section -->
    <div id="reminders" class="dashboard-section" style="display:none;">
      <div class="section-title">Upcoming Reminders</div>
      <div class="board-wrapper" id="remindersList"></div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="dependantModal" class="modal">
  <div class="modal-content">
    <h2 id="modalTitle">Add Dependant</h2>
    <p class="error" id="modalError"></p>
    <form id="dependantForm">
      <label>Name:</label>
      <input type="text" id="depName" required />
      <label>Phone Number:</label>
      <input type="text" id="depPhone" placeholder="Enter 8-digit phone number" required />
      <div id="phoneNote" class="phone-note">Phone number must be exactly 8 digits and start with 6, 8, or 9.</div>

      <label>Type of Medicine:</label>
      <input type="text" id="depMedicine" required />

      <label>Dosage:</label>
      <div class="dosage-row">
        <input type="number" id="depDosageNumber" min="0" value="0" required />
        <select id="depDosageUnit" required>
          <option value="">Unit</option>
          <option value="mg">mg</option>
          <option value="g">g</option>
        </select>
      </div>
      <div id="dosageNote" class="dosage-note">Dosage must be at least 1.</div>

      <label>Number of Times to Take Medication:</label>
      <input type="number" id="numTimes" min="0" value="0" />

      <div id="timesSection" style="display:none; margin-top:8px;">
        <label>Times to Take Medication:</label>
        <div id="timesContainer"></div>
        <div id="duplicateNote" class="duplicate-note">Duplicate times are not allowed!</div>
      </div>

      <label>Additional Notes:</label>
      <input type="text" id="depNotes" placeholder="Enter 'NA' if none" required />

      <button type="submit">Save Dependant</button>
      <button type="button" id="closeModalBtn" style="background:#9ca3af;margin-top:4px;">Cancel</button>
    </form>
  </div>
</div>

<div id="deletePopup" class="delete-popup">
  <p>Are you sure you want to delete this dependant?<br>Once deleted, it cannot be recovered.</p>
  <button class="btn-confirm" id="confirmDeleteBtn">Yes, Delete</button>
  <button class="btn-cancel" id="cancelDeleteBtn">Cancel</button>
</div>

<script>
let dependantAdded=false;
let editing=false;
let currentDependant=null;

const addBtn=document.getElementById('addDependantBtn');
const editBtn=document.getElementById('editDependantBtn');
const removeBtn=document.getElementById('removeDependantBtn');
const modal=document.getElementById('dependantModal');
const closeModalBtn=document.getElementById('closeModalBtn');
const form=document.getElementById('dependantForm');
const errorMsg=document.getElementById('modalError');
const infoBox=document.getElementById('dependantInfo');
const dispName=document.getElementById('dispName');
const dispPhone=document.getElementById('dispPhone');
const dispMedicine=document.getElementById('dispMedicine');
const dispDosage=document.getElementById('dispDosage');
const dispTimes=document.getElementById('dispTimes');
const dispNotes=document.getElementById('dispNotes');
const dosageNumberInput=document.getElementById('depDosageNumber');
const depDosageUnit=document.getElementById('depDosageUnit');
const phoneInput=document.getElementById('depPhone');
const numTimesInput=document.getElementById('numTimes');
const timesContainer=document.getElementById('timesContainer');
const timesSection=document.getElementById('timesSection');
const duplicateNote=document.getElementById('duplicateNote');
const deletePopup=document.getElementById('deletePopup');
const confirmDeleteBtn=document.getElementById('confirmDeleteBtn');
const cancelDeleteBtn=document.getElementById('cancelDeleteBtn');
const mainError=document.getElementById('mainError');
const remindersList=document.getElementById('remindersList');

dosageNote.style.display='none';
phoneNote.style.display='none';
duplicateNote.style.display='none';

function resetDosageNote(){dosageNote.style.display='none'; dosageNumberInput.style.border='1px solid #ccc';}
function resetPhoneNote(){phoneNote.style.display='none'; phoneInput.style.border='1px solid #ccc';}

addBtn.addEventListener('click',()=>{
    if(dependantAdded && !editing){mainError.textContent="You can only add one dependant in the Basic plan."; setTimeout(()=>{mainError.textContent='';},5000); return;}
    errorMsg.textContent=''; modal.classList.add('active');
});

closeModalBtn.addEventListener('click',()=>{modal.classList.remove('active'); form.reset(); resetDosageNote(); resetPhoneNote(); timesContainer.innerHTML=''; timesSection.style.display='none'; duplicateNote.style.display='none';});

dosageNumberInput.addEventListener('input',()=>{if(parseInt(dosageNumberInput.value)<1){dosageNote.style.display='block'; dosageNumberInput.style.border='2px solid red';}else resetDosageNote();});

phoneInput.addEventListener('input',()=>{
    let val=phoneInput.value.replace(/\D/g,''); if(val.length>8) val=val.slice(0,8); phoneInput.value=val;
    if(val.length!==8 || !/^[689]/.test(val)){phoneNote.style.display='block'; phoneInput.style.border='2px solid red';} else resetPhoneNote();
});

numTimesInput.addEventListener('input', generateTimeInputs);

function generateTimeInputs(){
    const count=parseInt(numTimesInput.value)||0;
    timesSection.style.display = count>0?'block':'none';
    const existingInputs = Array.from(timesContainer.querySelectorAll('input.timeInput'));
    while(existingInputs.length>count) timesContainer.removeChild(timesContainer.lastChild);
    for(let i=existingInputs.length;i<count;i++){
        const input=document.createElement('input');
        input.type='time'; input.required=true; input.style.width='100%'; input.style.marginBottom='6px'; input.classList.add('timeInput');
        input.addEventListener('input', checkDuplicates); timesContainer.appendChild(input);
    }
    checkDuplicates();
}

function checkDuplicates(){
    const inputs=Array.from(timesContainer.querySelectorAll('.timeInput'));
    const values=inputs.map(i=>i.value).filter(v=>v!==''); let hasDuplicate=false;
    inputs.forEach(i=>i.style.border='1px solid #ccc');
    values.forEach(val=>{
        const firstIndex=inputs.findIndex(i=>i.value===val);
        inputs.forEach((input,i)=>{if(input.value===val && i!==firstIndex){input.style.border='2px solid red'; hasDuplicate=true;}});
    });
    duplicateNote.style.display=hasDuplicate?'block':'none';
    return hasDuplicate;
}

form.addEventListener('submit',function(e){
    e.preventDefault();
    if(checkDuplicates()){errorMsg.textContent="Please remove duplicate times before continuing."; return;}
    const name=depName.value.trim();
    const phone=phoneInput.value.trim();
    const medicine=depMedicine.value.trim();
    const dosageNumber=parseInt(dosageNumberInput.value);
    const dosageUnit=depDosageUnit.value;
    const notes=depNotes.value.trim();
    const times=Array.from(timesContainer.querySelectorAll('.timeInput')).map(i=>i.value).filter(v=>v!=='');
    if(!name||!medicine||!dosageUnit||!notes||dosageNumber<1||!/^\d{8}$/.test(phone)||!/^[689]/.test(phone)||times.length!==parseInt(numTimesInput.value)){
        errorMsg.textContent="Please fill all fields correctly: Dosage â‰¥1, valid time, valid 8-digit phone number, and all times entered."; return;
    }
    dispName.textContent=name; dispPhone.textContent=phone; dispMedicine.textContent=medicine; dispDosage.textContent=`${dosageNumber} ${dosageUnit}`; dispTimes.textContent=times.join(', '); dispNotes.textContent=notes;
    infoBox.style.display='block'; dependantAdded=true; editing=false;
    currentDependant={name,phone,medicine,dosageNumber,dosageUnit,times,notes};
    updateReminders();
    modal.classList.remove('active'); form.reset(); resetDosageNote(); resetPhoneNote(); timesContainer.innerHTML=''; timesSection.style.display='none'; duplicateNote.style.display='none'; errorMsg.textContent='';
});

function updateReminders(){remindersList.innerHTML=''; if(!currentDependant) return; currentDependant.times.forEach(time=>{const div=document.createElement('div'); div.className='reminder-item'; div.textContent=`${currentDependant.name} - ${currentDependant.medicine} at ${time}`; div.addEventListener('click',()=>infoBox.style.display='block'); remindersList.appendChild(div);});}

editBtn.addEventListener('click',()=>{if(!currentDependant) return; editing=true; addBtn.click();
depName.value=currentDependant.name; phoneInput.value=currentDependant.phone; depMedicine.value=currentDependant.medicine;
dosageNumberInput.value=currentDependant.dosageNumber; depDosageUnit.value=currentDependant.dosageUnit; depNotes.value=currentDependant.notes;
numTimesInput.value=currentDependant.times.length; generateTimeInputs();
const inputs=Array.from(timesContainer.querySelectorAll('.timeInput')); currentDependant.times.forEach((t,i)=>inputs[i].value=t);
});

removeBtn.addEventListener('click',()=>{if(!dependantAdded) return; deletePopup.style.display='block';});
confirmDeleteBtn.addEventListener('click',()=>{infoBox.style.display='none'; dependantAdded=false; currentDependant=null;
dispName.textContent=''; dispPhone.textContent=''; dispMedicine.textContent=''; dispTimes.textContent=''; dispDosage.textContent=''; dispNotes.textContent='';
remindersList.innerHTML=''; deletePopup.style.display='none';});
cancelDeleteBtn.addEventListener('click',()=>{deletePopup.style.display='none';});

const navItems=document.querySelectorAll('.nav-item');
const sections=document.querySelectorAll('.dashboard-section');
navItems.forEach(item=>{item.addEventListener('click',()=>{navItems.forEach(i=>i.classList.remove('active')); item.classList.add('active'); const target=item.getAttribute('data-nav'); sections.forEach(sec=>sec.style.display=(sec.id===target?'block':'none'));});});
</script>

</body>
</html>
