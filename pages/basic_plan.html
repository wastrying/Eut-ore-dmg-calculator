<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Remblyx Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/png" sizes="32x32" href="../images/medisignal.png" />
<link rel="apple-touch-icon" href="../images/medisignal.png" />
<style>
  /* ===== Existing Remblyx CSS ===== */
  /* Keep all your existing CSS from before here */
  /* ... all the styles from your dashboard ... */

  /* ===== New dependant board CSS ===== */
  #dependant-board .board-header-row, #dependant-board .board-row {
    grid-template-columns: 2fr 2fr 1.2fr 1.2fr 2fr 1fr;
  }
  .dependant-actions button {
    border: none;
    padding: 4px 8px;
    border-radius: 6px;
    font-size: var(--text-sm);
    cursor: pointer;
  }
  #dependantModal, #deletePopup {
    position: fixed;
    top:0; left:0; width:100%; height:100%;
    display:none;
    align-items:center; justify-content:center;
    background:rgba(0,0,0,0.35);
    z-index:2000;
  }
  #dependantModal .modal-content, #deletePopup {
    background:#fff;
    padding:16px;
    border-radius:var(--radius-md);
    box-shadow:0 10px 26px rgba(0,0,0,.2);
    width:90%;
    max-width:400px;
  }
  #dependantModal input, #dependantModal select {
    width:100%; margin:4px 0 12px; padding:8px;
    border:1px solid #e5e7eb; border-radius:6px;
  }
  #timePickerContainer input {
    width:100px; margin-right:6px;
  }
</style>
</head>
<body>
<div class="overlay"><img src="../images/background.png" class="bg-image" alt=""></div>
<div class="header-row" id="header-row">
  <button id="home-tap" class="home-tap" aria-label="Go to home" title="Home"></button>
  <img src="../images/remblyxlogo.png" alt="Remblyx" class="logo" id="logo" onclick="window.location.href='../index.html'">
</div>
<div class="wrapper">
  <div id="main-dashboard">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-title">Workspace</div>
      <div class="nav-item active" data-nav="board"><span class="icon-dot"></span><span class="label">Main Board</span></div>
      <div class="nav-item" data-nav="alerts"><span class="icon-dot"></span><span class="label">Alerts</span></div>
      <div class="nav-item" data-nav="reports"><span class="icon-dot"></span><span class="label">Reports</span></div>
      <div class="nav-item" data-nav="integrations"><span class="icon-dot"></span><span class="label">Integrations</span></div>
      <div class="sidebar-spacer"></div>
      <div id="sidebar-plan" class="sidebar-plan-label" title="Click to change plan">
        <span class="label-text">Current Plan</span>
        <strong id="plan-name">-</strong>
      </div>
      <div id="logout" class="logout-link">Log out</div>
      <div id="delete-account" class="logout-link" style="color:#f87171;">Delete account &amp; data</div>
    </aside>
    <div class="backdrop" id="backdrop"></div>
    <div class="main-area">
      <!-- Existing Boards -->
      <div class="top-bar">
        <div class="top-left">
          <button id="open-sidebar" class="mobile-menu-btn" aria-label="Open menu">â˜°</button>
          <div>
            <div id="board-title" class="board-title">Developer Command Center</div>
            <div id="board-subtitle" class="board-subtitle">Overview of all users, their subscriptions, and status.</div>
          </div>
        </div>
        <div class="top-actions"></div>
      </div>

      <!-- Standard Board -->
      <div id="standard-board" class="board-wrapper">
        <div class="board-header-row">
          <div>Item</div><div>Owner</div><div>Status</div><div>Due Date</div><div>Priority</div>
        </div>
        <div class="board-row"><div>Onboarding checks</div><div>You</div><div><span class="status-pill status-green">Done</span></div><div>Today</div><div>Low</div></div>
      </div>

      <!-- ===== New Dependant Board ===== -->
      <div id="dependant-board" class="board-wrapper" style="margin-top:16px;">
        <div class="board-header-row">
          <div>Dependant Name</div>
          <div>Medicine</div>
          <div>Times</div>
          <div>Dosage</div>
          <div>Notes</div>
          <div>Actions</div>
        </div>
        <div id="dependant-row" class="board-row" style="display:none;">
          <div id="dispName"></div>
          <div id="dispMedicine"></div>
          <div id="dispTimes"></div>
          <div id="dispDosage"></div>
          <div id="dispNotes"></div>
          <div class="dependant-actions">
            <button id="editDependantBtn" style="background:#3b82f6;color:white;">Edit</button>
            <button id="removeDependantBtn" style="background:#f87171;color:white;">Remove</button>
          </div>
        </div>
        <button id="addDependantBtn" style="margin-top:8px;background:#4CAF50;color:white;">Add Dependant</button>
      </div>

    </div> <!-- end main-area -->
  </div> <!-- end main-dashboard -->
</div> <!-- end wrapper -->

<!-- ===== Dependant Modal ===== -->
<div id="dependantModal">
  <div class="modal-content">
    <h2 id="modalTitle">Add Dependant</h2>
    <p class="error" id="modalError" style="color:#b91c1c;"></p>
    <form id="dependantForm">
      <label>Name:</label>
      <input type="text" id="depName" required />

      <label>Type of Medicine:</label>
      <input type="text" id="depMedicine" required />

      <label>Dosage:</label>
      <div class="dosage-row">
        <input type="number" id="depDosageNumber" min="0" placeholder="Amount" required />
        <select id="depDosageUnit" required>
          <option value="">Unit</option>
          <option value="mg">mg</option>
          <option value="g">g</option>
        </select>
      </div>

      <label>Times per day:</label>
      <input type="number" id="depDosageTimes" min="1" max="10" placeholder="Enter number of times" required />

      <div id="timePickerContainer" class="time-picker-container" style="display:none;margin-top:10px;">
        <label>Times to Take Medicine:</label>
        <div id="timeInputs"></div>
      </div>

      <label>Additional Notes:</label>
      <input type="text" id="depNotes" placeholder="Enter 'NA' if none" required />

      <button type="submit" style="background:#4CAF50;color:white;">Save Dependant</button>
      <button type="button" id="closeModalBtn" style="background:#9ca3af;color:white;margin-top:4px;">Cancel</button>
    </form>
  </div>
</div>

<!-- Delete Confirmation Popup -->
<div id="deletePopup">
  <p>Are you sure you want to delete this dependant?<br>Once deleted, it cannot be recovered.</p>
  <button class="btn-confirm" id="confirmDeleteBtn" style="background:#f87171;color:white;">Yes, Delete</button>
  <button class="btn-cancel" id="cancelDeleteBtn" style="background:#9ca3af;color:white;">Cancel</button>
</div>

<script>
  // ===== JS for Dependant Management =====
  let dependantAdded = false;
  let editing = false;

  const addBtn = document.getElementById('addDependantBtn');
  const editBtn = document.getElementById('editDependantBtn');
  const removeBtn = document.getElementById('removeDependantBtn');
  const modal = document.getElementById('dependantModal');
  const closeModalBtn = document.getElementById('closeModalBtn');
  const form = document.getElementById('dependantForm');
  const errorMsg = document.getElementById('modalError');
  const modalTitle = document.getElementById('modalTitle');

  const infoRow = document.getElementById('dependant-row');
  const dispName = document.getElementById('dispName');
  const dispMedicine = document.getElementById('dispMedicine');
  const dispTimes = document.getElementById('dispTimes');
  const dispDosage = document.getElementById('dispDosage');
  const dispNotes = document.getElementById('dispNotes');

  const dosageTimesInput = document.getElementById('depDosageTimes');
  const timePickerContainer = document.getElementById('timePickerContainer');
  const timeInputs = document.getElementById('timeInputs');

  const deletePopup = document.getElementById('deletePopup');
  const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
  const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');

  addBtn.addEventListener('click', () => {
    if(dependantAdded && !editing){
      alert("You can only add one dependant in the Basic plan.");
      return;
    }
    modalTitle.textContent = editing ? "Edit Dependant" : "Add Dependant";
    modal.style.display = 'flex';
  });

  closeModalBtn.addEventListener('click', () => {
    modal.style.display = 'none';
    form.reset();
    timePickerContainer.style.display = 'none';
    errorMsg.textContent = '';
  });

  dosageTimesInput.addEventListener('input', () => {
    const count = parseInt(dosageTimesInput.value);
    timeInputs.innerHTML = '';
    if(count > 0){
      timePickerContainer.style.display = 'block';
      for(let i=1;i<=count;i++){
        const timeInput = document.createElement('input');
        timeInput.type = 'time';
        timeInput.required = true;
        timeInput.className = 'time-input';
        timeInputs.appendChild(timeInput);
      }
    } else {
      timePickerContainer.style.display = 'none';
    }
  });

  form.addEventListener('submit', function(e){
    e.preventDefault();
    const name = depName.value.trim();
    const medicine = depMedicine.value.trim();
    const dosageNumber = depDosageNumber.value.trim();
    const dosageUnit = depDosageUnit.value;
    const dosageTimes = depDosageTimes.value.trim();
    const notes = depNotes.value.trim();
    const timeValues = Array.from(timeInputs.querySelectorAll('input[type="time"]')).map(i=>i.value);

    if(!name || !medicine || !dosageNumber || !dosageUnit || !dosageTimes || timeValues.includes('') || !notes){
      errorMsg.textContent = "Please fill all required fields. Enter 'NA' if none.";
      return;
    }

    const dosageText = `${dosageNumber} ${dosageUnit}, ${dosageTimes} time(s) per day`;
    const timeText = timeValues.join(', ');

    dispName.textContent = name;
    dispMedicine.textContent = medicine;
    dispTimes.textContent = timeText;
    dispDosage.textContent = dosageText;
    dispNotes.textContent = notes;

    infoRow.style.display = 'grid';
    dependantAdded = true;
    editing = false;

    modal.style.display = 'none';
    form.reset();
    timePickerContainer.style.display = 'none';
    errorMsg.textContent = '';
  });

  editBtn.addEventListener('click', () => {
    editing = true;
    addBtn.click();
    depName.value = dispName.textContent;
    depMedicine.value = dispMedicine.textContent;
    depDosageNumber.value = dispDosage.textContent.split(' ')[0];
    depDosageUnit.value = dispDosage.textContent.split(' ')[1];
    const timesPerDay = parseInt(dispDosage.textContent.match(/\d+/g)[1]);
    depDosageTimes.value = timesPerDay;
    dosageTimesInput.dispatchEvent(new Event('input'));
    const currentTimes = dispTimes.textContent.split(', ');
    const timeInputsEls = timeInputs.querySelectorAll('input[type="time"]');
    currentTimes.forEach((t, i) => { if(timeInputsEls[i]) timeInputsEls[i].value = t; });
    depNotes.value = dispNotes.textContent;
  });

  removeBtn.addEventListener('click', () => {
    if(!dependantAdded) return;
    deletePopup.style.display = 'flex';
  });

  confirmDeleteBtn.addEventListener('click', () => {
    infoRow.style.display = 'none';
    dependantAdded = false;
    dispName.textContent = '';
    dispMedicine.textContent = '';
    dispTimes.textContent = '';
    dispDosage.textContent = '';
    dispNotes.textContent = '';
    deletePopup.style.display = 'none';
  });

  cancelDeleteBtn.addEventListener('click', () => {
    deletePopup.style.display = 'none';
  });
</script>
</body>
</html>
