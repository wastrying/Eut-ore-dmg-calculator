<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Remblyx Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/png" sizes="32x32" href="../images/medisignal.png">
<link rel="apple-touch-icon" href="../images/medisignal.png">
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif;}
body{background:#f5f5f5;min-height:100vh;color:#222;display:flex;justify-content:center;align-items:flex-start;padding:16px;position:relative;}
.wrapper{width:100%;max-width:1200px;margin-top:58px;display:flex;flex-direction:column;gap:16px;z-index:10;}
.board-wrapper{background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px;padding:16px;max-width:600px;overflow:auto;}
button{padding:8px 12px;border:none;border-radius:6px;background:#4CAF50;color:white;cursor:pointer;}
button:hover{background:#45a049;}
.dependant-info{margin-top:12px;padding:12px;background:#fff;border-left:4px solid #4CAF50;border-radius:6px; display:none;}
.dependant-actions{display:flex;gap:8px;margin-top:10px;}
.error{color:red;font-weight:bold;margin-bottom:8px;}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:1000;}
.modal.active{display:flex;}
.modal-content{background:#fff;padding:20px;border-radius:12px;width:90%;max-width:400px;box-shadow:0 8px 24px rgba(0,0,0,0.3);}
.modal-content h2{margin-top:0;}
.modal-content label{display:block;margin:8px 0 4px;font-weight:600;}
.modal-content input,.modal-content select{width:100%;padding:6px 8px;margin-bottom:10px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box;}
.modal-content .dosage-row{display:flex;gap:6px;}
.modal-content .dosage-row input{flex:1;}
.modal-content .dosage-row select{flex:1;}
.time-picker-container{display:none;margin-top:10px;}
.time-picker-container .time-input{display:block;margin-bottom:6px;}
.time-picker-container .time-input.duplicate{border:2px solid red;}
.time-note{font-size:12px;color:red;margin-top:2px;display:none;}
.dosage-note{font-size:12px;color:red;margin-top:2px;display:none;}
.phone-note{font-size:12px;color:red;margin-top:2px;display:none;}
.delete-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border-radius:12px;padding:24px;box-shadow:0 8px 24px rgba(0,0,0,0.3);display:none;z-index:2000;max-width:400px;text-align:center;}
.delete-popup p{margin-bottom:20px;font-weight:600;}
.delete-popup button{margin:0 8px;padding:8px 14px;border:none;border-radius:6px;cursor:pointer;}
.btn-confirm{background:#f87171;color:white;}
.btn-cancel{background:#9ca3af;color:white;}
input[type="number"]{width:100%;cursor:pointer;}
input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: auto; margin: 0; }
</style>
</head>
<body>
<div class="wrapper">
    <div class="board-wrapper">
        <h2>Basic Plan Dashboard</h2>
        <div id="mainError" class="error"></div>
        <button id="addDependantBtn">Add Dependant</button>

        <div id="dependantInfo" class="dependant-info">
            <h3>Dependant Profile</h3>
            <p><strong>Name:</strong> <span id="dispName"></span></p>
            <p><strong>Phone Number:</strong> <span id="dispPhone"></span></p>
            <p><strong>Medicine Type:</strong> <span id="dispMedicine"></span></p>
            <p><strong>Times to Take Medicine:</strong> <span id="dispTimes"></span></p>
            <p><strong>Dosage:</strong> <span id="dispDosage"></span></p>
            <p><strong>Additional Notes:</strong> <span id="dispNotes"></span></p>
            <div class="dependant-actions">
                <button id="editDependantBtn" style="background:#3b82f6;">Edit</button>
                <button id="removeDependantBtn" style="background:#f87171;">Remove</button>
            </div>
        </div>
    </div>
</div>

<div id="dependantModal" class="modal">
    <div class="modal-content">
        <h2 id="modalTitle">Add Dependant</h2>
        <p class="error" id="modalError"></p>
        <form id="dependantForm">
            <label>Name:</label>
            <input type="text" id="depName" required />

            <label>Phone Number:</label>
            <input type="text" id="depPhone" placeholder="Enter phone number" required />
            <div id="phoneNote" class="phone-note">Please enter a valid phone number (7–15 digits).</div>

            <label>Type of Medicine:</label>
            <input type="text" id="depMedicine" required />

            <label>Dosage:</label>
            <div class="dosage-row">
                <input type="number" id="depDosageNumber" min="0" value="0" required />
                <select id="depDosageUnit" required>
                    <option value="">Unit</option>
                    <option value="mg">mg</option>
                    <option value="g">g</option>
                </select>
            </div>
            <div id="dosageNote" class="dosage-note">Dosage must be at least 1.</div>

            <label>Times per day:</label>
            <input type="number" id="depDosageTimes" min="0" max="10" value="0" required />
            <div id="timePickerContainer" class="time-picker-container">
                <label>Times to Take Medicine:</label>
                <div id="timeInputs"></div>
                <div id="timeNote" class="time-note">Each time must be unique. Duplicate times are not allowed.</div>
            </div>

            <label>Additional Notes:</label>
            <input type="text" id="depNotes" placeholder="Enter 'NA' if none" required />

            <button type="submit">Save Dependant</button>
            <button type="button" id="closeModalBtn" style="background:#9ca3af;margin-top:4px;">Cancel</button>
        </form>
    </div>
</div>

<div id="deletePopup" class="delete-popup">
    <p>Are you sure you want to delete this dependant?<br>Once deleted, it cannot be recovered.</p>
    <button class="btn-confirm" id="confirmDeleteBtn">Yes, Delete</button>
    <button class="btn-cancel" id="cancelDeleteBtn">Cancel</button>
</div>

<script>
let dependantAdded = false;
let editing = false;

const addBtn = document.getElementById('addDependantBtn');
const editBtn = document.getElementById('editDependantBtn');
const removeBtn = document.getElementById('removeDependantBtn');
const modal = document.getElementById('dependantModal');
const closeModalBtn = document.getElementById('closeModalBtn');
const form = document.getElementById('dependantForm');
const errorMsg = document.getElementById('modalError');
const modalTitle = document.getElementById('modalTitle');
const infoBox = document.getElementById('dependantInfo');
const dispName = document.getElementById('dispName');
const dispPhone = document.getElementById('dispPhone');
const dispMedicine = document.getElementById('dispMedicine');
const dispTimes = document.getElementById('dispTimes');
const dispDosage = document.getElementById('dispDosage');
const dispNotes = document.getElementById('dispNotes');
const dosageNumberInput = document.getElementById('depDosageNumber');
const dosageTimesInput = document.getElementById('depDosageTimes');
const timePickerContainer = document.getElementById('timePickerContainer');
const timeInputs = document.getElementById('timeInputs');
const deletePopup = document.getElementById('deletePopup');
const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
const mainError = document.getElementById('mainError');
const timeNote = document.getElementById('timeNote');
const dosageNote = document.getElementById('dosageNote');
const phoneInput = document.getElementById('depPhone');
const phoneNote = document.getElementById('phoneNote');

phoneNote.style.display = 'none';
timeNote.style.display = 'none';
dosageNote.style.display = 'none';

function resetTimeNote(){timeNote.style.display='none';}
function resetDosageNote(){dosageNote.style.display='none';dosageNumberInput.style.border='1px solid #ccc';}
function resetPhoneNote(){phoneNote.style.display='none';phoneInput.style.border='1px solid #ccc';}

addBtn.addEventListener('click', () => {
    if(dependantAdded && !editing){
        mainError.textContent = "You can only add one dependant in the Basic plan.";
        setTimeout(() => { mainError.textContent = ''; }, 5000);
        return;
    }
    mainError.textContent = '';
    modalTitle.textContent = editing ? "Edit Dependant" : "Add Dependant";
    modal.classList.add('active');
});

closeModalBtn.addEventListener('click', () => {
    modal.classList.remove('active');
    form.reset();
    timePickerContainer.style.display='none';
    errorMsg.textContent='';
    resetTimeNote();
    resetDosageNote();
    resetPhoneNote();
});

dosageTimesInput.addEventListener('input', () => {
    let count = parseInt(dosageTimesInput.value);
    if (isNaN(count) || count < 0) count = 0;
    dosageTimesInput.value = count;
    timeInputs.innerHTML='';
    resetTimeNote();
    if(count>0){
        timePickerContainer.style.display='block';
        for(let i=0;i<count;i++){
            const ti=document.createElement('input');
            ti.type='time';ti.required=true;ti.className='time-input';
            ti.addEventListener('input', checkDuplicateTimes);
            timeInputs.appendChild(ti);
        }
    } else {
        timePickerContainer.style.display='none';
    }
});

dosageNumberInput.addEventListener('input', ()=>{
    if(parseInt(dosageNumberInput.value)<1){
        dosageNumberInput.style.border='2px solid red';
        dosageNote.style.display='block';
    } else {
        resetDosageNote();
    }
});

phoneInput.addEventListener('input', ()=>{
    const val = phoneInput.value.trim();
    if(!/^\d*$/.test(val)){
        phoneInput.style.border='2px solid red';
        phoneNote.style.display='block';
    } else {
        resetPhoneNote();
    }
});

function checkDuplicateTimes(){
    const times = Array.from(timeInputs.querySelectorAll('input')).map(i=>i.value);
    let hasDuplicate=false;
    document.querySelectorAll('.time-input').forEach((input,i)=>{
        const index=times.indexOf(input.value);
        if(input.value!=='' && times.indexOf(input.value)!==i){
            input.classList.add('duplicate');
            hasDuplicate=true;
        } else {
            input.classList.remove('duplicate');
        }
    });
    timeNote.style.display = hasDuplicate ? 'block':'none';
}

form.addEventListener('submit', function(e){
    e.preventDefault();
    const name=depName.value.trim();
    const phone=phoneInput.value.trim();
    const medicine=depMedicine.value.trim();
    const dosageNumber=parseInt(dosageNumberInput.value);
    const dosageUnit=depDosageUnit.value;
    const dosageTimes=parseInt(dosageTimesInput.value);
    const notes=depNotes.value.trim();
    const timeValues=Array.from(timeInputs.querySelectorAll('input[type="time"]')).map(i=>i.value);

    if(!name||!medicine||!dosageUnit||!dosageTimes||!notes||timeValues.includes('')||document.querySelectorAll('.time-input.duplicate').length>0||dosageNumber<1||!/^\d{7,15}$/.test(phone)){
        errorMsg.textContent="Please fill all fields correctly. Dosage ≥1, times unique, and valid phone number.";
        return;
    }

    dispName.textContent=name;
    dispPhone.textContent=phone;
    dispMedicine.textContent=medicine;
    dispDosage.textContent=`${dosageNumber} ${dosageUnit}, ${dosageTimes} time(s) per day`;
    dispTimes.textContent=timeValues.join(', ');
    dispNotes.textContent=notes;
    infoBox.style.display='block';
    dependantAdded=true;
    editing=false;
    modal.classList.remove('active');
    form.reset();
    timePickerContainer.style.display='none';
    errorMsg.textContent='';
    resetTimeNote();
    resetDosageNote();
    resetPhoneNote();
});

editBtn.addEventListener('click',()=>{
    editing=true;
    addBtn.click();
    depName.value=dispName.textContent;
    phoneInput.value=dispPhone.textContent;
    depMedicine.value=dispMedicine.textContent;
    dosageNumberInput.value=parseInt(dispDosage.textContent);
    depDosageUnit.value=dispDosage.textContent.split(' ')[1];
    dosageTimesInput.value=dispDosage.textContent.match(/\d+/g)[1];
    dosageTimesInput.dispatchEvent(new Event('input'));
    const currentTimes=dispTimes.textContent.split(', ');
    const timeInputsEls=timeInputs.querySelectorAll('input');
    currentTimes.forEach((t,i)=>{ if(timeInputsEls[i]) timeInputsEls[i].value=t; });
    depNotes.value=dispNotes.textContent;
});

removeBtn.addEventListener('click',()=>{ if(!dependantAdded)return; deletePopup.style.display='block'; });
confirmDeleteBtn.addEventListener('click',()=>{ infoBox.style.display='none'; dependantAdded=false; dispName.textContent=''; dispPhone.textContent=''; dispMedicine.textContent=''; dispTimes.textContent=''; dispDosage.textContent=''; dispNotes.textContent=''; deletePopup.style.display='none'; });
cancelDeleteBtn.addEventListener('click',()=>{ deletePopup.style.display='none'; });

</script>
</body>
</html>
