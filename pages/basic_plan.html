<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Remblyx Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/png" sizes="32x32" href="../images/medisignal.png" />
<link rel="apple-touch-icon" href="../images/medisignal.png" />
<style>
/* ===== Global Styles ===== */
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif;}
body{background:#f5f5f5;min-height:100vh;color:#222;display:flex;justify-content:center;align-items:flex-start;padding:16px;position:relative;}
.wrapper{width:100%;max-width:1200px;margin-top:58px;display:flex;flex-direction:column;gap:16px;z-index:10;}

/* ===== Board Styles ===== */
.board-wrapper{background:#f9fafb;border:1px solid #e5e7eb;border-radius:12px;padding:16px;max-width:600px;overflow:auto;}
button{padding:8px 12px;border:none;border-radius:6px;background:#4CAF50;color:white;cursor:pointer;}
button:hover{background:#45a049;}
.dependant-info{margin-top:12px;padding:12px;background:#fff;border-left:4px solid #4CAF50;border-radius:6px; display:none;}
.dependant-actions{display:flex;gap:8px;margin-top:10px;}
.error{color:red;font-weight:bold;margin-bottom:8px;}

/* Modal Styles */
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:1000;}
.modal.active{display:flex;}
.modal-content{background:#fff;padding:20px;border-radius:12px;width:90%;max-width:400px;box-shadow:0 8px 24px rgba(0,0,0,0.3);}
.modal-content h2{margin-top:0;}
.modal-content label{display:block;margin:8px 0 4px;font-weight:600;}
.modal-content input,.modal-content select{width:100%;padding:6px 8px;margin-bottom:10px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box;}
.modal-content .dosage-row{display:flex;gap:6px;}
.modal-content .dosage-row input{flex:1;}
.modal-content .dosage-row select{flex:1;}
.time-picker-container{display:none;margin-top:10px;}
.time-picker-container .time-input{display:block;margin-bottom:6px;}

/* Delete confirmation popup */
.delete-popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;border-radius:12px;padding:24px;box-shadow:0 8px 24px rgba(0,0,0,0.3);display:none;z-index:2000;max-width:400px;text-align:center;}
.delete-popup p{margin-bottom:20px;font-weight:600;}
.delete-popup button{margin:0 8px;padding:8px 14px;border:none;border-radius:6px;cursor:pointer;}
.btn-confirm{background:#f87171;color:white;}
.btn-cancel{background:#9ca3af;color:white;}

/* Dashboard Header */
.header-row{position:fixed;top:8px;left:8px;z-index:40}
.logo{height:160px;cursor:pointer;transition:.3s ease}
.logo:hover{filter:brightness(1.1);transform:scale(1.03)}

/* General Inputs */
input[type="number"]::-webkit-inner-spin-button, input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
</style>
</head>
<body>
<div class="wrapper">
    <div class="board-wrapper">
        <h2>Basic Plan Dashboard</h2>
        <!-- Error above the Add Dependant button -->
        <div id="mainError" class="error" style="margin-bottom:8px;"></div>
        <button id="addDependantBtn">Add Dependant</button>
        <div id="dependantInfo" class="dependant-info">
            <h3>Dependant Profile</h3>
            <p><strong>Name:</strong> <span id="dispName"></span></p>
            <p><strong>Medicine Type:</strong> <span id="dispMedicine"></span></p>
            <p><strong>Times to Take Medicine:</strong> <span id="dispTimes"></span></p>
            <p><strong>Dosage:</strong> <span id="dispDosage"></span></p>
            <p><strong>Additional Notes:</strong> <span id="dispNotes"></span></p>
            <div class="dependant-actions">
                <button id="editDependantBtn" style="background:#3b82f6;">Edit</button>
                <button id="removeDependantBtn" style="background:#f87171;">Remove</button>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Dependant Modal -->
<div id="dependantModal" class="modal">
    <div class="modal-content">
        <h2 id="modalTitle">Add Dependant</h2>
        <p class="error" id="modalError"></p>
        <form id="dependantForm">
            <label for="depName">Name:</label>
            <input type="text" id="depName" required />
            <label for="depMedicine">Type of Medicine:</label>
            <input type="text" id="depMedicine" required />
            <label for="depDosage">Dosage:</label>
            <div class="dosage-row">
                <input type="number" id="depDosageNumber" min="0" placeholder="Amount" required />
                <select id="depDosageUnit" required>
                    <option value="">Unit</option>
                    <option value="mg">mg</option>
                    <option value="g">g</option>
                </select>
            </div>
            <label for="depDosageTimes">Times per day:</label>
            <input type="number" id="depDosageTimes" min="1" max="10" placeholder="Enter number of times" required />
            <div id="timePickerContainer" class="time-picker-container">
                <label>Times to Take Medicine:</label>
                <div id="timeInputs"></div>
            </div>
            <label for="depNotes">Additional Notes:</label>
            <input type="text" id="depNotes" placeholder="Enter 'NA' if none" required />
            <button type="submit">Save Dependant</button>
            <button type="button" id="closeModalBtn" style="background:#9ca3af;margin-top:4px;">Cancel</button>
        </form>
    </div>
</div>
<!-- Delete Confirmation Popup -->
<div id="deletePopup" class="delete-popup">
    <p>Are you sure you want to delete this dependant?<br>Once deleted, it cannot be recovered.</p>
    <button class="btn-confirm" id="confirmDeleteBtn">Yes, Delete</button>
    <button class="btn-cancel" id="cancelDeleteBtn">Cancel</button>
</div>

<script>
let dependantAdded = false;
let editing = false;

const addBtn = document.getElementById('addDependantBtn');
const editBtn = document.getElementById('editDependantBtn');
const removeBtn = document.getElementById('removeDependantBtn');
const modal = document.getElementById('dependantModal');
const closeModalBtn = document.getElementById('closeModalBtn');
const form = document.getElementById('dependantForm');
const errorMsg = document.getElementById('modalError');
const modalTitle = document.getElementById('modalTitle');
const infoBox = document.getElementById('dependantInfo');
const dispName = document.getElementById('dispName');
const dispMedicine = document.getElementById('dispMedicine');
const dispTimes = document.getElementById('dispTimes');
const dispDosage = document.getElementById('dispDosage');
const dispNotes = document.getElementById('dispNotes');
const dosageTimesInput = document.getElementById('depDosageTimes');
const timePickerContainer = document.getElementById('timePickerContainer');
const timeInputs = document.getElementById('timeInputs');
const deletePopup = document.getElementById('deletePopup');
const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
const mainError = document.getElementById('mainError');

// Add dependant
addBtn.addEventListener('click', () => {
    if(dependantAdded && !editing){
        mainError.textContent = "You can only add one dependant in the Basic plan.";
        return;
    } else {
        mainError.textContent = ""; // clear error if allowed
    }
    modalTitle.textContent = editing ? "Edit Dependant" : "Add Dependant";
    modal.classList.add('active');
});

// Close modal
closeModalBtn.addEventListener('click', () => {
    modal.classList.remove('active');
    form.reset();
    timePickerContainer.style.display = 'none';
    errorMsg.textContent = '';
});

// Show time pickers vertically
dosageTimesInput.addEventListener('input', () => {
    const count = parseInt(dosageTimesInput.value);
    timeInputs.innerHTML = '';
    if(count > 0){
        timePickerContainer.style.display = 'block';
        for(let i=1;i<=count;i++){
            const timeInput = document.createElement('input');
            timeInput.type = 'time';
            timeInput.required = true;
            timeInput.className = 'time-input';
            timeInputs.appendChild(timeInput);
        }
    } else {
        timePickerContainer.style.display = 'none';
    }
});

// Save dependant
form.addEventListener('submit', function(e){
    e.preventDefault();
    const name = depName.value.trim();
    const medicine = depMedicine.value.trim();
    const dosageNumber = depDosageNumber.value.trim();
    const dosageUnit = depDosageUnit.value;
    const dosageTimes = depDosageTimes.value.trim();
    const notes = depNotes.value.trim();
    const timeValues = Array.from(timeInputs.querySelectorAll('input[type="time"]')).map(i=>i.value);

    if(!name || !medicine || !dosageNumber || !dosageUnit || !dosageTimes || timeValues.includes('') || !notes){
        errorMsg.textContent = "Please fill all required fields. Enter 'NA' if there are no additional notes.";
        return;
    }

    const dosageText = `${dosageNumber} ${dosageUnit}, ${dosageTimes} time(s) per day`;
    const timeText = timeValues.join(', ');

    dispName.textContent = name;
    dispMedicine.textContent = medicine;
    dispTimes.textContent = timeText;
    dispDosage.textContent = dosageText;
    dispNotes.textContent = notes;
    infoBox.style.display = 'block';
    dependantAdded = true;
    editing = false;
    modal.classList.remove('active');
    form.reset();
    timePickerContainer.style.display = 'none';
    errorMsg.textContent = '';
});

// Edit dependant
editBtn.addEventListener('click', () => {
    editing = true;
    addBtn.click();
    depName.value = dispName.textContent;
    depMedicine.value = dispMedicine.textContent;
    depDosageNumber.value = dispDosage.textContent.split(' ')[0];
    depDosageUnit.value = dispDosage.textContent.split(' ')[1];
    const timesPerDay = parseInt(dispDosage.textContent.match(/\d+/g)[1]);
    depDosageTimes.value = timesPerDay;
    dosageTimesInput.dispatchEvent(new Event('input'));
    const currentTimes = dispTimes.textContent.split(', ');
    const timeInputsEls = timeInputs.querySelectorAll('input[type="time"]');
    currentTimes.forEach((t, i) => { if(timeInputsEls[i]) timeInputsEls[i].value = t; });
    depNotes.value = dispNotes.textContent;
});

// Remove dependant
removeBtn.addEventListener('click', () => {
    if(!dependantAdded) return;
    deletePopup.style.display = 'block';
});

confirmDeleteBtn.addEventListener('click', () => {
    infoBox.style.display = 'none';
    dependantAdded = false;
    dispName.textContent = '';
    dispMedicine.textContent = '';
    dispTimes.textContent = '';
    dispDosage.textContent = '';
    dispNotes.textContent = '';
    deletePopup.style.display = 'none';
});

cancelDeleteBtn.addEventListener('click', () => {
    deletePopup.style.display = 'none';
});
</script>
</body>
</html>
